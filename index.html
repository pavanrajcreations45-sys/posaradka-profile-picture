<!DOCTYPE html>
<html>
<head>
  <title>Posaradka Profile Picture</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      font-family: sans-serif;
      background: url("bg.jpg") no-repeat center center fixed;
      background-size: cover;
    }

    h2 {
      margin-top: 20px;
    }

    canvas {
      border: 2px solid #000;
      margin-top: 20px;
    }

    .controls {
      margin-top: 25px;
      margin-bottom: 40px;
    }

    .btn {
      display: inline-block;
      padding: 30px 70px;
      font-size: 30px;
      font-weight: bold;
      border-radius: 15px;
      cursor: pointer;
      border: none;
      margin: 15px;
    }

    .upload-btn {
      background: #ff9800;
      color: white;
    }

    .download-btn {
      background: #4CAF50;
      color: white;
    }
  </style>
</head>

<body>

<h2>Posaradka Profile Picture</h2>

<canvas id="canvas" width="1080" height="1080"></canvas>

<div class="controls">
  <label for="upload" class="btn upload-btn">Upload Photo</label>
  <input type="file" id="upload" accept="image/*" hidden>
  <button id="download" class="btn download-btn">Download Image</button>
</div>

<script>
  const canvas = new fabric.Canvas('canvas', {
    preserveObjectStacking: true
  });

  let userImage;
  let frameImage;

  // Load Frame
  fabric.Image.fromURL('posaradka04.png', function(img) {
    frameImage = img;
    frameImage.scaleToWidth(1080);
    frameImage.set({
      selectable: false,
      evented: false
    });
    canvas.add(frameImage);
    canvas.bringToFront(frameImage);
  });

  // Upload Photo
  document.getElementById('upload').addEventListener('change', function(e) {
    const reader = new FileReader();
    reader.onload = function(f) {
      fabric.Image.fromURL(f.target.result, function(img) {

        if (userImage) {
          canvas.remove(userImage);
        }

        userImage = img;

        img.set({
          left: 540,
          top: 540,
          originX: 'center',
          originY: 'center',
          cornerSize: 20
        });

        img.scaleToWidth(800);

        canvas.add(img);
        canvas.sendToBack(img);
        canvas.bringToFront(frameImage);
      });
    };
    reader.readAsDataURL(e.target.files[0]);
  });

  // Download Image
  document.getElementById('download').addEventListener('click', function() {
    canvas.discardActiveObject();
    canvas.renderAll();

    const dataURL = canvas.toDataURL({
      format: 'png',
      quality: 1
    });

    const link = document.createElement('a');
    link.href = dataURL;
    link.download = "Posaradka_Profile.png";
    link.click();
  });

</script>

</body>
</html>
